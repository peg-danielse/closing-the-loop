# --- START: seq=0 ---

apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/window: "60s"
        autoscaling.knative.dev/stable-window: "60s"  # Default: 60s, Duration, 6s <= value <= 1h
        autoscaling.knative.dev/panic-window-percentage: "10.0" # Possible values: float, 1.0 <= value <= 100.0
        autoscaling.knative.dev/panic-threshold-percentage: "200.0" # Default: 200.0, Possible values: float, 110.0 <= value <= 1000.0
        
        autoscaling.knative.dev/initial-scale: "1"
        autoscaling.knative.dev/min-scale: "0" # 0 = no min
        autoscaling.knative.dev/max-scale: "0" # 0 = no max
        autoscaling.knative.dev/scale-down-delay: "0s" # Duration, 0s <= value <= 1h
        
        # autoscaling.knative.dev/class: "hpa.autoscaling.knative.dev"
        autoscaling.knative.dev/metric: "concurrency" # "concurrency", "rps", "cpu"*, "memory"*. *requires hpa.autoscaling
        autoscaling.knative.dev/target: "100" 
        autoscaling.knative.dev/target-utilization-percentage: "70" # hotness of the target value to scale on.
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
          - name: h2c
            containerPort: 8084
        resources:
          requests:
            cpu: 100m
          limits:
            cpu: 1000m

---

{
  'changed_service_anomaly_count': 0,
  'max_throughput': 0,
  'service_max_cpu_usage': 0,
  'total_anomaly_count': 0,
  'total_errors': 0,
  'total_max_cpu_usage': 0
}
# --- END: seq=0 ---
# --- START: seq=1 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '0'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 0s
        autoscaling.knative.dev/stable-window: 60s
        autoscaling.knative.dev/target: '100'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 60s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 201.4, 'total_errors': 5999, 'total_anomaly_count': 18, 'changed_service_anomaly_count': 4, 'service_max_cpu_usage': 4.015592129755286, 'total_max_cpu_usage': 5.942138330791021, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=1 ---

# --- START: seq=2 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '0'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 0s
        autoscaling.knative.dev/stable-window: 60s
        autoscaling.knative.dev/target: '100'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 60s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 201.4, 'total_errors': 5999, 'total_anomaly_count': 18, 'changed_service_anomaly_count': 4, 'service_max_cpu_usage': 4.015592129755286, 'total_max_cpu_usage': 5.942138330791021, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=2 ---

# --- START: seq=3 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '10'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 0s
        autoscaling.knative.dev/stable-window: 60s
        autoscaling.knative.dev/target: '50'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 60s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 148.9, 'total_errors': 3288, 'total_anomaly_count': 21, 'changed_service_anomaly_count': 8, 'service_max_cpu_usage': 3.432519676457461, 'total_max_cpu_usage': 4.6454254843488965, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=3 ---

# --- START: seq=4 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '10'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 5s
        autoscaling.knative.dev/stable-window: 60s
        autoscaling.knative.dev/target: '50'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 60s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 161.6, 'total_errors': 4979, 'total_anomaly_count': 31, 'changed_service_anomaly_count': 7, 'service_max_cpu_usage': 4.020245099642005, 'total_max_cpu_usage': 6.033692672569174, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=4 ---

# --- START: seq=5 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '20'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 5s
        autoscaling.knative.dev/stable-window: 60s
        autoscaling.knative.dev/target: '100'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 60s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 180.0, 'total_errors': 26840, 'total_anomaly_count': 40, 'changed_service_anomaly_count': 14, 'service_max_cpu_usage': 1.4395097547061857, 'total_max_cpu_usage': 2.5716373151088794, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=5 ---

# --- START: seq=6 ---
apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: srv-rate
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/initial-scale: '1'
        autoscaling.knative.dev/max-scale: '20'
        autoscaling.knative.dev/metric: concurrency
        autoscaling.knative.dev/min-scale: '1'
        autoscaling.knative.dev/panic-threshold-percentage: '200.0'
        autoscaling.knative.dev/panic-window-percentage: '10.0'
        autoscaling.knative.dev/scale-down-delay: 5s
        autoscaling.knative.dev/stable-window: 120s
        autoscaling.knative.dev/target: '100'
        autoscaling.knative.dev/target-utilization-percentage: '70'
        autoscaling.knative.dev/window: 120s
    spec:
      containers:
      - command:
        - rate
        env:
        - name: DLOG
          value: DEBUG
        image: pag3r/hotel-reservations:latest
        name: hotel-reserv-rate
        ports:
        - containerPort: 8084
          name: h2c
        resources:
          limits:
            cpu: 1000m
          requests:
            cpu: 100m

---
{'max_throughput': 148.9, 'total_errors': 5677, 'total_anomaly_count': 16, 'changed_service_anomaly_count': 5, 'service_max_cpu_usage': 4.322568413648437, 'total_max_cpu_usage': 6.095466543171212, 'service_names': ['srv-rate', 'config-autoscaler']}
# --- END: seq=6 ---

